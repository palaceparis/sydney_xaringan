---
title: "Multiple Regression Analysis on Birthweight "
subtitle: "DATA2002 Group Presentation"
author: "Kevin Qiu, Rajat Lal, Taoran Bu, Mingze Gong, Yiren Cao"
date: "11 November 2020"
output:
  xaringan::moon_reader:
    css: ["default", "assets/sydney-fonts.css", "assets/sydney.css"]
    self_contained: false # if true, fonts will be stored locally
    seal: true # show a title slide with YAML information
    includes:
      in_header: "assets/mathjax-equation-numbers.html"
    nature:
      beforeInit: ["assets/remark-zoom.js", "https://platform.twitter.com/widgets.js"]
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: '16:9' # alternatives '16:9' or '4:3' or others e.g. 13:9
      navigation:
        scroll: false # disable slide transitions by scrolling
---

```{r, echo = FALSE, results='hide',  message=FALSE, warning=FALSE}
library(janitor)
library(skimr)
library(tidyr)
library(MASS)
library(readr)
library(ggfortify)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(visdat)
library(sjPlot)
library(leaps)
library(caret)
```


```{r, echo = FALSE, results='hide',  message=FALSE, warning=FALSE}
data = MASS::birthwt
data = data %>% mutate(
  low = as.factor(low),
  race = as.character(race),
  smoke = as.character(smoke),
  ui = as.character(ui),
  ht = as.character(ht)
)

data_without_low = subset(data, select = -low)
data_with_low = data
```


```{r,include=FALSE, echo = FALSE, results='hide',  message=FALSE, warning=FALSE}
data_without_low_for_correlation = data_without_low
data_without_low_for_correlation[] <- lapply(data_without_low_for_correlation,                    function(x)as.numeric(as.character(x)))
qtlcharts::iplotCorr(data_without_low_for_correlation) # non-multicollinearity

lm1_without_low = lm(bwt ~ ., data = data_without_low)
autoplot(lm1_without_low, which = 1:2) # linearity + normality
```

```{r, include=FALSE, echo = FALSE, results='hide',  message=FALSE, warning=FALSE}
data = data %>% mutate(
  race = case_when(
    race == 1 ~ "white",
    race == 2 ~ "black",
    race == 3 ~ "other"
  )
)

data = data %>% mutate(
  ui = case_when(
    ui == 1 ~ "yes",
    ui == 0 ~ "no"
  )
)

data = data %>% mutate(
  ht = case_when(
    ht == 1 ~ "yes",
    ht == 0 ~ "no"
  )
)

data = data %>% mutate(
  smoke = case_when(
    smoke == 1 ~ "yes",
    smoke == 0 ~ "no"
  )
)

data = data %>% mutate(
  low = case_when(
    low == 1 ~ "yes",
    low == 0 ~ "no"
  )
)

data_without_low = subset(data, select = -low)
data_with_low = data
```


```{r, include=FALSE, echo = FALSE, results='hide',  message=FALSE, warning=FALSE}
M1 = lm1_without_low  # Full model
M0 = lm(bwt ~ 1, data = data_without_low)  # Null model
```


```{r, include=FALSE, echo = FALSE, results='hide',  message=FALSE, warning=FALSE}
# drop1(M1, test = "F")
# M2 = update(M1, . ~ . - ftv)
# drop1(M2, test = "F")
# M3 = update(M2, . ~ . - age)
# drop1(M3, test = "F")
# M4 = update(M3, . ~ . - ptl)
# drop1(M4, test = "F")

step(M1)
```


```{r, include=FALSE, echo = FALSE, results='hide',  message=FALSE, warning=FALSE}
step.back.aic = step(M1, direction = "backward", trace = FALSE)
round(summary(step.back.aic)$coef,3)
step.back.aic %>%broom::glance() %>% round(2) %>% t()
```


```{r, include=FALSE, echo = FALSE, results='hide',  message=FALSE, warning=FALSE}
step.fwd.aic = step(M0, 
                    scope = list(lower = M0, upper = M1), 
                    direction = "forward", trace = FALSE)
round(summary(step.fwd.aic)$coef,3)
step.back.aic %>%broom::glance() %>% round(2) %>% t()
```

```{r, include=FALSE, echo = FALSE, results='hide',  message=FALSE, warning=FALSE}
library(equatiomatic)
equatiomatic::extract_eq(step.fwd.aic, intercept = "beta",use_coefs = TRUE)
```


```{r, include=FALSE, echo = FALSE, results='hide',  message=FALSE, warning=FALSE}
exh = regsubsets(bwt~., data = data_without_low, nvmax = 8)
summary(exh)$outmat
```

```{r, include=FALSE, echo = FALSE, results='hide',  message=FALSE, warning=FALSE}
cv_without_low = train(
  bwt ~ lwt + race + smoke + ht+ ui, data_without_low,
  method = "lm",
  trControl = trainControl(
    method = "cv", number = 10,
    verboseIter = FALSE
  )
)

cv_without_low
```


```{r, include=FALSE, echo = FALSE, results='hide',  message=FALSE, warning=FALSE}
autoplot(step.fwd.aic, which = 1:2)
#GGally::ggpairs(data_without_low %>% select(lwt, race, smoke, ht,ui, bwt))
```


```{r, include=FALSE, echo = FALSE, results='hide',  message=FALSE, warning=FALSE}
reg1 = lm(bwt ~ ., data = data_with_low)
autoplot(reg1, which = 1:2)
```

```{r, include=FALSE, echo = FALSE, results='hide',  message=FALSE, warning=FALSE}
W1 = reg1  # full model
W0 = lm(bwt ~ 1, data = data_with_low) # null model
```

```{r, include=FALSE, echo = FALSE, results='hide',  message=FALSE, warning=FALSE}
step(W1)
```


```{r, include=FALSE, echo = FALSE, results='hide',  message=FALSE, warning=FALSE}
step.back.aic_with_low = step(W1, direction = "backward", trace = FALSE)
round(summary(step.back.aic_with_low)$coef,3)
step.back.aic_with_low %>%broom::glance() %>% round(2) %>% t()
```


```{r, include=FALSE, echo = FALSE, results='hide',  message=FALSE, warning=FALSE}
step.fwd.aic_with_low = step(W0, scope = list(lower = W0, upper = W1), direction = "forward", trace = FALSE)
summary(step.fwd.aic_with_low)
```

```{r, include=FALSE, echo = FALSE, results='hide',  message=FALSE, warning=FALSE}
exh = regsubsets(bwt~., data = data_with_low, nvmax = 9)
summary(exh)$outmat
```

```{r, include=FALSE, echo = FALSE, results='hide',  message=FALSE, warning=FALSE}
cv_with_low = train(
  bwt ~ low + ui+ smoke + race, data,
  method = "lm",
  trControl = trainControl(
    method = "cv", number = 10,
    verboseIter = FALSE
  )
)
library(xtable)
```

```{r, include=FALSE, echo = FALSE, results='hide',  message=FALSE, warning=FALSE}
cv_with_low
cv_without_low
```

class: title-slide,middle
background-image: url("assets/USydLogo-white.svg"), url("assets/title-image1.jpg")
background-position: 10% 90%, 100% 50%
background-size: 160px, 50% 100%
background-color: #0148A4


# .text-shadow[.white[Data Description]]

## .white[Rajat Lal, Taoran Bu]

---
## Background

.pull-left[
The purpose of this statistical report is to bring light to what particular risk factors help predict infant birth weight. The future health of the infant can be predicted from the birth weight of the child.

<br>


The data was collected from Baystate Medical Center, Springfield, Massachusetts in 1986 which is accessible in Rstudio via the MASS package under ‘birthwt’.

]

.pull-right[
```{r, echo = FALSE, fig.align="right", fig.cap = "Baystate Medical Center"}
knitr::include_graphics("Picture1.png")
```

]

.footnote[
Image source: ???
]
---

## Questions

.pull-left[
1. If smoking is in fact a predicting factor for birth weight of babies, in particular does it have a negative coefficient.

2. Does mother’s birth weight in the last menstrual period predict baby birth weight?

3. What are all the significant predicting factors of baby birth weight?
]

.pull-right[
```{r, echo = FALSE, fig.align="right"}
knitr::include_graphics("Picture2.png")
```

]

.footnote[
Image source: ???
]
---
## Pre Analysis Observations


There are ten variables in this dataset, as shown by the summary statistics:

- Mean birth weight is approximately 2.9kg, about 600 grams below the expected mean of 3.5kg. This is within the normal range of weights of 2.5kg-




.scroll-box-14[
```{r, echo = FALSE, warning=FALSE}
library(MASS)
summary(birthwt)
```
]

---
## birthwt in R

Here a glimpse of the data set we are going to use in the further research.


```{r, echo = FALSE, message=FALSE, warning=FALSE}
library(dplyr)
library(MASS)
glimpse(birthwt)
```

---
class: title-slide,middle
background-image: url("assets/USydLogo-white.svg"), url("assets/title-image3.jpg")
background-position: 10% 90%, 100% 50%
background-size: 160px, 50% 100%
background-color: #0148A4


# .text-shadow[.white[Assumption Checking]]

## .white[Yiren Cao]

---

## Data handling

.scroll-box-20[
```{r, echo = FALSE, message=FALSE, warning=FALSE}
glimpse(birthwt)
summary(birthwt)
head(birthwt)
# data %>% skimr::skim()
# visdat::vis_miss(data)

# data = data %>% mutate(
#   low = as.factor(low),
#   race = as.character(race),
#   smoke = as.character(smoke),
#   ui = as.character(ui),
#   ht = as.character(ht)
# )
# 
# data_without_low = data %>% dplyr::select(-low)
# data_with_low = data
```
]

---
## Assumption Checking - Linearity, Homoskedasticity
```{r, echo = FALSE, message=FALSE, warning=FALSE, fig.width=16, fig.height=15}
{{qtlcharts::iplotCorr(birthwt)}} # non-multicollinearity
```

---
## GGally::ggpairs
.center[
```{r, echo = FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=8}
GGally::ggpairs(data_without_low)
```
]
---

## Assumption Checking - Linearity, Homoskedasticity, Normality
.center[
```{r, echo = FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6}
lm1_without_low = lm(bwt ~ ., data = data_without_low)
autoplot(lm1_without_low, which = 1:2) # linearity + normality
```
]

.center[.font110[
`r icon::fa("bell")`&nbsp;In addition, we can assume the Independence
]
]
---
## Assumption Checking - No Multicollinearity

.center[
```{r, echo = FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=5}
M1 = lm1_without_low  # Full model
vif_values <- regclass::VIF(M1)
library(knitr)
kable(vif_values)

```
]
<br>

.blockquote[
### `r icon::fa("location-arrow")` Variance Inflation Factor (VIF)
- When VIF is equal to 1, the independent variables are not correlated to the one another.
]
---
class: inverse, center, middle
# Another model: with `low` predictor


---
## Assumption Checking - Linearity, Homoskedasticity, Normality
.center[
```{r, echo = FALSE, message=FALSE, warning=FALSE, fig.width=12, fig.height=6}
reg1 = lm(bwt ~ ., data = data_with_low)
autoplot(reg1, which = 1:2)
```
]

.center[.font110[
`r icon::fa("bell")`&nbsp;In addition, we can assume the Independence
]
]
---
## Assumption Checking - No Multicollinearity

.content-box-blue[
.center[.font100[
Another model with 'low' predictor
]
]
]

.center[
```{r, message=FALSE, warning=FALSE, echo= FALSE, fig.width=12, fig.height=5}
vif_values_with_low <- regclass::VIF(reg1)
kable(vif_values_with_low)
```
]

---
class: title-slide,middle
background-image: url("assets/USydLogo-white.svg"), url("assets/title-image1.jpg")
background-position: 10% 90%, 100% 50%
background-size: 160px, 50% 100%
background-color: #0148A4


# .text-shadow[.white[Analysis]]

## .white[Results]

### .white[Mingze Gong]

---
## Final models

We have the following models:

.content-box-blue[
.scroll-output[
.font90[
$$\operatorname{bwt} = 2362.21 - 525.52(\operatorname{ui}_{\operatorname{yes}}) + 126.91(\operatorname{race}_{\operatorname{other}}) + 475.06(\operatorname{race}_{\operatorname{white}}) - 356.32(\operatorname{smoke}_{\operatorname{yes}}) - 585.19(\operatorname{ht}_{\operatorname{yes}}) + 4.24(\operatorname{lwt}) + \epsilon$$
]
]
]

.content-box-blue[
.font90[
$$\operatorname{bwt}_{low} = 3294.45 - 1131.17(\operatorname{low}_{\operatorname{yes}}) - 309.28(\operatorname{ui}_{\operatorname{yes}}) + 16.48(\operatorname{race}_{\operatorname{other}}) + 206.36(\operatorname{race}_{\operatorname{white}}) - 157.3(\operatorname{smoke}_{\operatorname{yes}}) + \epsilon$$

]
]


.center[
.font170[Questions  `r icon::fa("question", pull = "centre", color = 'red')` 
]
]

--
.center[
.font170[Which one is better `r icon::fa("question", pull = "centre", color = 'red')` 
]
]
--
--
.center[
.font170[Is there a better model here `r icon::fa("question", pull = "centre", color = 'red')` 
]
]
--
.center[
.font190[Drop1&Update = AIC backward = AIC forward
]
]
---
## In sample performance

<br>
.scroll-box-20[
```{r, echo = FALSE,  message=FALSE, warning=FALSE}
sjPlot::tab_model(
  step.fwd.aic, step.fwd.aic_with_low,
  show.ci = FALSE,
  show.aic = TRUE,
  dv.labels = c("Without low variable", "With low variable")
)
```
]

---
## Out of sample performance
.pull-left[
.scroll-output[
```{r}
cv_with_low
```
]
]

.pull-right[
.scroll-output[
```{r}
cv_without_low
```
]
]

<br>
.center[
.font120[Classification And Regression Training]]

---
## Limits and possible improvements

<br>

<blockquote>
Sociological theories often imply that two or more variables interact in their effects upon some dependent variable.
.right[-- <cite>Blalock, 1965</cite>]
</blockquote>

<br>

.scroll-box-14[
```{r, echo = FALSE,  message=FALSE, warning=FALSE}
t = lm(bwt~ui+race+smoke+ht+lwt+lwt*ht, data = data_without_low)
tab_model(t,
          dv.labels = "plus interaction between lwt and ht"
)
```
]
